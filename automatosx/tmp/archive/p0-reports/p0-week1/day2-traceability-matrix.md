# P0 Week 1 Day 2 – Feature Preservation Traceability Matrix

Quality is not an act, it's a habit. Test early, test often, test everything.

## Overview
- Scope: 10 critical v1→v2 preservation checkpoints identified in the v2 module inventory.
- Method: Combined Day 1 decision inputs, live coverage audits, and W1D2 alignment workshop outputs.
- Ownership: QA maintains this artifact; feature owners update rows as automation lands.

## Traceability Matrix
| Item # | Checklist Item | Feature Description | v1 Coverage Status | v2 Test Requirements | Unit Test Candidates | Integration / Contract Tests | End-to-End / CLI Tests | Success Criteria | Owner | Target Date | Risk (L/I) | Mitigation Notes |
|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1 | Multi-provider routing with automatic fallback | Router balances provider traffic, initiates fallback on failure/quota events. | 82% unit, 2 integration suites, chaos manual (gap: concurrency). | Add weighted routing, cooldown timers, telemetry parity. | `router-fallback-weighting.spec.ts` for priority scoring and cooldown logic. | Contract suite with mocked provider APIs injecting 5xx/429 and latency jitter. | CLI smoke `@provider-router` forcing failover, chaos cron validating telemetry deltas. | Fallback attempts <2, success ≥99%, telemetry variance ≤5%. | Bob | 2025-01-09 | M/H | Expand chaos harness in nightly CI; add fallback counter alert. |
| 2 | Agent execution with delegation and resumability | Delegation chains persist state and resume after interruptions. | 74% unit (AgentExecutor), 1 e2e (single hop), no multi-hop coverage. | Cover depth≥3, suspend/resume, crash recovery, manual override logging. | `delegation-state-machine-depth.spec.ts` verifying checkpoint tokens. | Executor contract tests persisting state across process restarts. | CLI `ax session resume` flow exercising pause, crash, resume. | Resume latency ≤30s, zero data loss, audit log 100% coverage of state changes. | Queenie & Avery | 2025-01-09 | M/H | Fault-injection harness in CI; add resume telemetry audit. |
| 3 | Memory search (keyword + vector) with FTS5 + sqlite-vec | Unified search provides consistent keyword/vector/hybrid results. | 88% unit (keyword), manual staging vector checks, no automated hybrid tests. | Automate vector precision + hybrid fallback, schema migration smoke. | `memory-search-vector.spec.ts` validating cosine similarity thresholds. | Seeded sqlite-vec corpus contract test comparing v1/v2 golden outputs. | CLI `@memory-regression` comparing keyword vs vector results across datasets. | Recall variance ≤5%, migration success 100%, hybrid fallback <200ms. | Queenie & Data | 2025-01-09 | H/H | Golden dataset diff nightly, recall alert at >5% delta. |
| 4 | Checkpoint/resume for long-running tasks | Long tasks checkpoint and resume with telemetry. | 69% unit (serializer), manual 60+ min scripts, no automated DAO tests. | Automate DAO persistence, resume after upgrade, partial failure rollback. | `checkpoint-serializer-evolution.spec.ts` covering schema upgrades. | Service tests injecting storage/network failures during checkpoint writes. | CLI resilient job >15 min resumed via `ax checkpoint resume`. | 100% resume success across 5 runs, checkpoint staleness <10 min, telemetry events emitted. | Avery | 2025-01-10 | M/H | Synthetic job fixture in CI, telemetry gated release. |
| 5 | Spec-driven workflows with parallel execution | Declarative specs run parallel branches with ordered outcomes. | 71% unit (parser), integration covers sequential only, no parallel automation. | Validate DAG parallelism, branch retries, dependency resolution telemetry. | `workflow-spec-parallel.spec.ts` verifying branch metadata. | Orchestration contract executing DAG with synthetic retries and dependencies. | CLI `@spec-parallel` scenario running 3 branches with induced partial failure. | Parallel branches finish within SLA, retries respect limits, telemetry captures branch state. | Bob | 2025-01-09 | M/H | Introduce spec fixtures + execution graph diffing in CI. |
| 6 | Configuration validation and feature flags | Schema validation and flags govern runtime behaviours. | 92% unit (config), ad hoc manual flag toggles, no rollback automation. | Automate rollback, remote override drift detection, Zod coverage. | `feature-flag-evaluator-edge.spec.ts` for staged rollout percentages. | Contract tests with config loader + remote override service verifying drift alerts. | CLI regression toggling critical flags with assertive telemetry checks. | Invalid configs blocked 100%, flag propagation <5 min, drift alert latency <2 min. | Stan | 2025-01-08 | M/M | Snapshot diff workflow, canary toggle test on every deploy. |
| 7 | MCP server integration and tool execution | MCP servers register tools, respect sandbox constraints. | 68% unit, 1 integration suite (happy path), no negative cases automated. | Add permission denial, timeout, version drift, sandbox boundary tests. | `mcp-tool-runner-negative.spec.ts` covering timeout/denied flows. | Stub MCP server contract suite exercising success/failure/timeouts. | CLI `@mcp-regression` script invoking tool success + failure. | Success, timeout, failure paths all emit correct telemetry; sandbox escapes 0. | Bob & DevOps | 2025-01-10 | M/M | Add stub MCP server to CI, monitor timeout metrics. |
| 8 | CLI command parity (26 existing commands) | v2 CLI matches v1 command/flags/telemetry. | Snapshot diff script, smoke tests for 5 commands (~35% coverage). | Automate full command surface, verify help text, telemetry parity, new commands gating. | `command-registry.spec.ts` ensuring registration + flag coverage. | CLI contract generating JSON manifest diff vs v1 baseline. | CLI tour `@cli-full` running all 26 commands + new ones. | 26/26 commands pass, help diff = 0 critical, telemetry variance ≤5%, flake rate ≤2%. | Frank & Stan | 2025-01-10 | M/H | Maintain manifest baseline, nightly CLI tour on macOS/Linux. |
| 9 | Workspace management and file operations | WorkspaceManager enforces path isolation and lifecycle. | 85% unit (path resolver), minimal concurrency/e2e coverage. | Add symlink, concurrent writes, temp lifecycle, audit log backfill. | `workspace-manager-security.spec.ts` verifying ACL + symlink rejection. | Workspace CRUD contract using sandbox snapshot + concurrent ops. | CLI scenario `@workspace-ops` covering create/update/delete and alias resolution. | Unauthorized access attempts = 0, cleanup SLA <2 min, audit log completeness 100%. | Stan & Queenie | 2025-01-08 | M/M | Filesystem chaos suite, audit log dashboard added to CI gating. |
| 10 | Cost tracking and telemetry | Aggregated provider costs with telemetry instrumentation. | Manual reconciliation vs billing exports, limited unit coverage (CostTracker 64%). | Automate aggregation across providers, anomaly alerts, telemetry dashboards. | `cost-aggregator-multivendor.spec.ts` for blended rate calculations. | Integration ingesting synthetic billing feeds + verifying aggregation. | CLI `@cost-regression` command comparing expected totals, telemetry dashboard diff. | Cost variance ≤5%, anomaly alerts triggered within 5 min, dashboard freshness <1h. | Avery & DevOps | 2025-01-10 | M/H | Synthetic billing feeds nightly, integrate with observability QA guardrails. |

## Gap Analysis Log
| Gap ID | Checklist Item | Description of Gap | Impact (Qual/Quant) | Owner | Due Date | Status / Notes |
|---|---|---|---|---|---|---|
| GAP-01 | 1 | No automated coverage for weighted provider routing and cooldown telemetry. | High risk of silent failover regression; blocks P0 exit criteria. | Bob | 2025-01-08 | In Progress – chaos harness update scheduled nightly. |
| GAP-02 | 2 | Missing multi-hop delegation e2e path and crash recovery validation. | Medium/high customer impact; resume reliability unverified. | Queenie | 2025-01-09 | Planned – new e2e spec drafted, awaiting executor mock. |
| GAP-03 | 3 | Lack of golden dataset for vector recall comparison in CI. | High likelihood of unnoticed precision loss; affects CLI memory flows. | Queenie & Data | 2025-01-08 | Blocked – waiting on dataset export from Data. |
| GAP-04 | 8 | CLI command manifest diff only covers core 5 commands; long tail untested. | High regression risk; CLI parity promise unmet. | Frank | 2025-01-09 | Not Started – needs automation harness. |
| GAP-05 | 10 | No automated synthetic billing feed to validate cost aggregation. | Financial telemetry may drift without detection. | Avery & DevOps | 2025-01-09 | In Progress – DevOps scripting feed generator. |

## Risk Summary & Triggers
| Checklist Item | Trigger Condition | Monitoring Source | Escalation Path | Last Reviewed |
|---|---|---|---|---|
| 1 | Fallback success rate <99% in nightly chaos run. | Chaos dashboard run `#AX-P0-CHAOS`. | Bob → Queenie → Program PM. | 2025-01-07 |
| 2 | Resume latency >30s or failure >0 in fault-injection suite. | Fault-injection CI job logs. | Queenie → Avery → CTO. | 2025-01-07 |
| 3 | Recall variance >5% vs golden dataset or migration failure. | Memory diff report `memory-diff.log`. | Queenie → Data Lead → Program PM. | 2025-01-07 |
| 8 | CLI tour flake >2% or command diff mismatch. | CLI regression dashboard. | Frank → Stan → Queenie. | 2025-01-07 |
| 10 | Cost variance >5% or telemetry freshness >1h. | Observability QA dashboard. | Avery → DevOps → Program PM. | 2025-01-07 |

Maintain daily updates; align with W1D5 regression suite readiness review.
