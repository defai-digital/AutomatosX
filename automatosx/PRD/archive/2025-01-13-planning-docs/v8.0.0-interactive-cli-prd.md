# AutomatosX v8.0.0 - Interactive CLI Mode PRD

**Version:** 8.0.0
**Status:** Ready for Implementation
**Priority:** P0 (Critical Gap)
**Timeline:** 2 weeks (Week 1-2 of 6-week roadmap)
**Effort:** 10 person-days

---

## Executive Summary

Interactive CLI Mode provides a ChatGPT-style REPL interface that makes AutomatosX accessible to beginners while maintaining expert power-user workflows. This feature transforms AutomatosX from an experts-only tool into a conversational AI assistant that can execute complex workflows through natural dialogue.

**Impact:**
- **Accessibility:** Beginners can use AutomatosX without memorizing commands
- **Discovery:** Natural conversation reveals capabilities organically
- **Productivity:** Context-aware sessions eliminate repetitive parameter entry
- **Learning:** Built-in help and examples accelerate onboarding

**Success Criteria:**
- Launch REPL with `ax cli` command
- Support 13 slash commands (`/help`, `/agents`, `/memory`, etc.)
- Token-by-token streaming responses
- Persistent conversation history with SQLite
- Context-aware command suggestions
- <200ms input latency

---

## Problem Statement

### Current State (v8.0.0)

AutomatosX requires exact command syntax:
```bash
ax workflow run workflows/security-audit.yaml --config config.json
ax memory search "authentication logic" --limit 10
ax agent list --filter backend
```

**Barriers:**
- Must memorize 15+ commands with specific flags
- No discovery mechanism for capabilities
- No conversational refinement of queries
- Lost context between commands
- Steep learning curve for new users

### Target State (v7.6.1 Parity)

Natural language REPL interface:
```
$ ax cli
> Hello! How can I help with your codebase?

You: "Show me all security vulnerabilities"
Assistant: [Streams analysis results with agent collaboration]

You: "Fix the critical ones"
Assistant: [Generates fixes using SecurityAgent + QualityAgent]

You: /agents
[Lists 21 available agents with capabilities]

You: /memory recent 5
[Shows last 5 conversation turns]
```

---

## Architecture

### System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Interactive CLI Layer                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ REPLSession  â”‚â”€â”€â”€â–¶â”‚  SlashCmd    â”‚â”€â”€â”€â–¶â”‚ Conversation â”‚  â”‚
â”‚  â”‚   Manager    â”‚    â”‚   Registry   â”‚    â”‚   Context    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â”‚         â–¼                    â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Streaming   â”‚    â”‚   Command    â”‚    â”‚   History    â”‚  â”‚
â”‚  â”‚   Handler    â”‚    â”‚   Executor   â”‚    â”‚    Store     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚
          â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Existing v8.0.0 Infrastructure                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ProviderRouterV2  â”‚  AgentRegistry  â”‚  WorkflowEngineV2   â”‚
â”‚  MemoryService     â”‚  ConversationDAOâ”‚  MessageDAO         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Core Components

#### 1. REPLSession (`src/cli/interactive/REPLSession.ts`)

**Responsibilities:**
- Initialize readline interface with autocomplete
- Handle input events (line, CTRL+C, CTRL+D)
- Route input to slash commands or natural language handler
- Manage session state and context
- Graceful shutdown and cleanup

**Key Methods:**
```typescript
export class REPLSession {
  private rl: readline.Interface;
  private context: ConversationContext;
  private commands: SlashCommandRegistry;
  private streaming: StreamingHandler;
  private isProcessing: boolean = false;

  async start(): Promise<void>;
  async stop(): Promise<void>;
  private handleInput(input: string): Promise<void>;
  private autocomplete(line: string): [string[], string];
  private displayWelcome(): void;
  private displayPrompt(): void;
}
```

**Input Flow:**
```
User Input
    â”‚
    â”œâ”€ Starts with '/' â”€â”€â–¶ SlashCommandRegistry
    â”‚                      (13 built-in commands)
    â”‚
    â””â”€ Natural language â”€â”€â–¶ NaturalLanguageRouter
                             â”‚
                             â”œâ”€ Intent: query â”€â”€â–¶ MemoryService
                             â”œâ”€ Intent: workflow â”€â”€â–¶ WorkflowEngine
                             â”œâ”€ Intent: agent â”€â”€â–¶ AgentRuntime
                             â””â”€ Intent: chat â”€â”€â–¶ ProviderRouter
```

#### 2. SlashCommandRegistry (`src/cli/interactive/SlashCommandRegistry.ts`)

**13 Slash Commands:**

| Command | Purpose | Example |
|---------|---------|---------|
| `/help` | Show all commands | `/help` |
| `/agents` | List agents | `/agents backend` |
| `/agent <name>` | Use specific agent | `/agent security` |
| `/memory <query>` | Search memory | `/memory "auth logic"` |
| `/workflow <path>` | Run workflow | `/workflow cicd.yaml` |
| `/context` | Show current context | `/context` |
| `/clear` | Clear conversation | `/clear` |
| `/history [n]` | Show last n turns | `/history 10` |
| `/save <path>` | Export conversation | `/save conv.json` |
| `/load <path>` | Import conversation | `/load conv.json` |
| `/config` | Show configuration | `/config` |
| `/status` | System status | `/status` |
| `/exit` | Exit REPL | `/exit` or CTRL+D |

**Implementation:**
```typescript
export interface SlashCommand {
  name: string;
  description: string;
  usage: string;
  aliases?: string[];
  execute(args: string[], context: ConversationContext): Promise<void>;
}

export class SlashCommandRegistry {
  private commands: Map<string, SlashCommand> = new Map();

  register(command: SlashCommand): void;
  get(name: string): SlashCommand | undefined;
  list(): SlashCommand[];
  async execute(input: string, context: ConversationContext): Promise<void>;
}
```

**Example Command Implementation:**
```typescript
// src/cli/interactive/commands/AgentsCommand.ts
export class AgentsCommand implements SlashCommand {
  name = 'agents';
  description = 'List available agents';
  usage = '/agents [filter]';
  aliases = ['a'];

  constructor(private registry: AgentRegistry) {}

  async execute(args: string[], context: ConversationContext): Promise<void> {
    const filter = args[0];
    const agents = filter
      ? this.registry.list().filter(a => a.name.includes(filter))
      : this.registry.list();

    console.log(chalk.bold('\nğŸ“‹ Available Agents\n'));
    agents.forEach(agent => {
      console.log(`${chalk.cyan(agent.name)} - ${agent.description}`);
      console.log(`  Specializations: ${agent.specializations.join(', ')}`);
    });
  }
}
```

#### 3. StreamingHandler (`src/cli/interactive/StreamingHandler.ts`)

**Responsibilities:**
- Token-by-token response display
- Loading indicators during processing
- Color-coded output (system, user, assistant, error)
- Progress bars for long operations
- Graceful error display

**Implementation:**
```typescript
export class StreamingHandler {
  private spinner?: Ora;
  private currentLine: string = '';

  startThinking(message: string = 'Thinking...'): void {
    this.spinner = ora(message).start();
  }

  stopThinking(): void {
    this.spinner?.stop();
    this.spinner = undefined;
  }

  streamToken(token: string): void {
    // Write without newline
    process.stdout.write(chalk.white(token));
    this.currentLine += token;

    // Handle line breaks
    if (token.includes('\n')) {
      this.currentLine = '';
    }
  }

  finishStream(): void {
    if (!this.currentLine.endsWith('\n')) {
      process.stdout.write('\n');
    }
    this.currentLine = '';
  }

  displayError(error: Error): void {
    console.log(chalk.red('\nâŒ Error: ') + error.message);
  }

  displaySuccess(message: string): void {
    console.log(chalk.green('\nâœ… ' + message));
  }
}
```

#### 4. ConversationContext (`src/cli/interactive/ConversationContext.ts`)

**Context Management:**
```typescript
export interface ConversationContext {
  conversationId: string;
  userId: string;
  sessionStartedAt: Date;
  messageCount: number;
  activeAgent?: string;
  activeWorkflow?: string;
  variables: Record<string, unknown>;
  lastResults?: unknown;
}

export class ContextManager {
  private context: ConversationContext;
  private dao: ConversationDAO;

  async createSession(userId: string): Promise<string>;
  async loadSession(conversationId: string): Promise<void>;
  async addMessage(role: 'user' | 'assistant', content: string): Promise<void>;
  async getHistory(limit: number): Promise<Message[]>;
  async clearHistory(): Promise<void>;
  async saveContext(): Promise<void>;
  async restoreContext(): Promise<void>;

  setVariable(key: string, value: unknown): void;
  getVariable(key: string): unknown;
  setActiveAgent(agentName: string): void;
  clearActiveAgent(): void;
}
```

#### 5. NaturalLanguageRouter (`src/cli/interactive/NaturalLanguageRouter.ts`)

**Responsibilities:**
- Route natural language input to appropriate handler
- Quick pattern matching for common intents
- Fallback to LLM-based classification for complex queries
- Context-aware routing based on conversation history

**Implementation:**
```typescript
export interface Intent {
  type: 'query' | 'workflow' | 'agent' | 'chat' | 'command';
  confidence: number;
  parameters?: Record<string, unknown>;
}

export class NaturalLanguageRouter {
  private patterns: IntentPattern[] = [
    { regex: /^(search|find|show|list).*/i, intent: 'query' },
    { regex: /^(run|execute|start).*/i, intent: 'workflow' },
    { regex: /^(use|call|invoke).*agent/i, intent: 'agent' },
    { regex: /^(what|why|how|explain)/i, intent: 'chat' },
  ];

  constructor(
    private providerRouter: ProviderRouterV2,
    private context: ConversationContext
  ) {}

  async route(input: string): Promise<Intent> {
    // Fast pattern matching
    for (const pattern of this.patterns) {
      if (pattern.regex.test(input)) {
        return { type: pattern.intent, confidence: 0.9 };
      }
    }

    // LLM classification for complex queries
    return this.classifyWithLLM(input);
  }

  private async classifyWithLLM(input: string): Promise<Intent> {
    const response = await this.providerRouter.request({
      messages: [
        {
          role: 'system',
          content: `Classify user intent into: query, workflow, agent, chat, command.
Return JSON: { "intent": "...", "confidence": 0.0-1.0, "parameters": {...} }`
        },
        {
          role: 'user',
          content: input
        }
      ],
      temperature: 0.1
    });

    return JSON.parse(response.content);
  }
}
```

---

## Database Schema

### Extend Existing `conversations` and `messages` Tables

No schema changes needed - reuse existing conversation tracking:

```sql
-- Existing schema (from src/migrations/008_create_memory_system.sql)
CREATE TABLE IF NOT EXISTS conversations (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  started_at INTEGER NOT NULL,
  ended_at INTEGER,
  message_count INTEGER DEFAULT 0,
  context TEXT, -- JSON context including variables, active agent, etc.
  metadata TEXT -- JSON metadata
);

CREATE TABLE IF NOT EXISTS messages (
  id TEXT PRIMARY KEY,
  conversation_id TEXT NOT NULL,
  role TEXT NOT NULL CHECK(role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  timestamp INTEGER NOT NULL,
  tokens_used INTEGER,
  metadata TEXT, -- JSON metadata (provider, model, latency, etc.)
  FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
);
```

**New Context Fields** (stored in `conversations.context` JSON):
```json
{
  "sessionStartedAt": "2025-01-11T10:30:00Z",
  "messageCount": 15,
  "activeAgent": "security",
  "activeWorkflow": null,
  "variables": {
    "lastQuery": "authentication logic",
    "lastResults": [...],
    "projectPath": "/Users/user/project"
  }
}
```

---

## Implementation Plan

### Week 1: Core REPL Infrastructure

**Day 1-2: REPLSession + Input Handling**
- [ ] Create `src/cli/interactive/REPLSession.ts`
- [ ] Implement readline interface with autocomplete
- [ ] Handle input routing (slash vs natural language)
- [ ] Graceful shutdown (CTRL+C, CTRL+D)
- [ ] Unit tests for REPLSession

**Day 3-4: SlashCommandRegistry + 13 Commands**
- [ ] Create `SlashCommandRegistry.ts` with command interface
- [ ] Implement 13 slash commands:
  - [ ] `/help` - Show command list
  - [ ] `/agents` - List agents with filtering
  - [ ] `/agent <name>` - Set active agent
  - [ ] `/memory <query>` - Search conversation memory
  - [ ] `/workflow <path>` - Run workflow file
  - [ ] `/context` - Display current context
  - [ ] `/clear` - Clear conversation history
  - [ ] `/history [n]` - Show last n turns
  - [ ] `/save <path>` - Export conversation JSON
  - [ ] `/load <path>` - Import conversation JSON
  - [ ] `/config` - Show configuration
  - [ ] `/status` - System health status
  - [ ] `/exit` - Exit REPL
- [ ] Unit tests for each command

**Day 5: StreamingHandler**
- [ ] Create `StreamingHandler.ts`
- [ ] Implement token-by-token streaming
- [ ] Loading indicators with ora
- [ ] Color-coded output with chalk
- [ ] Progress bars for long operations
- [ ] Unit tests for streaming

**Deliverables:**
- âœ… Working REPL launches with `ax cli`
- âœ… All 13 slash commands functional
- âœ… Streaming responses with proper formatting
- âœ… Unit test coverage >80%

### Week 2: Context Management + Integration

**Day 6-7: ConversationContext + Persistence**
- [ ] Create `ConversationContext.ts` with context manager
- [ ] Integrate with existing `ConversationDAO` and `MessageDAO`
- [ ] Session creation and restoration
- [ ] Context variable management
- [ ] History retrieval and pagination
- [ ] Unit tests for context management

**Day 8-9: NaturalLanguageRouter**
- [ ] Create `NaturalLanguageRouter.ts`
- [ ] Pattern-based intent classification (fast path)
- [ ] LLM-based classification (fallback)
- [ ] Route to appropriate handler:
  - Query â†’ MemoryService
  - Workflow â†’ WorkflowEngineV2
  - Agent â†’ AgentRuntime
  - Chat â†’ ProviderRouterV2
- [ ] Integration tests with real handlers

**Day 10: Integration + Polish**
- [ ] CLI command registration: `ax cli`
- [ ] Welcome screen with examples
- [ ] Autocomplete improvements
- [ ] Error handling and recovery
- [ ] Performance optimization (<200ms input latency)
- [ ] End-to-end integration tests
- [ ] Documentation and examples

**Deliverables:**
- âœ… Full context persistence across sessions
- âœ… Natural language routing to all subsystems
- âœ… Production-ready with error handling
- âœ… Documentation in `docs/cli/interactive-mode.md`

---

## Testing Strategy

### Unit Tests (80%+ coverage)

**REPLSession Tests** (`src/cli/interactive/__tests__/REPLSession.test.ts`):
```typescript
describe('REPLSession', () => {
  it('should initialize readline interface', async () => {});
  it('should route slash commands to registry', async () => {});
  it('should route natural language to router', async () => {});
  it('should handle CTRL+C gracefully', async () => {});
  it('should handle CTRL+D (EOF) gracefully', async () => {});
  it('should provide autocomplete suggestions', async () => {});
  it('should ignore empty input', async () => {});
  it('should trim whitespace from input', async () => {});
});
```

**SlashCommandRegistry Tests** (`__tests__/SlashCommandRegistry.test.ts`):
```typescript
describe('SlashCommandRegistry', () => {
  it('should register and retrieve commands', () => {});
  it('should list all commands', () => {});
  it('should execute command by name', async () => {});
  it('should execute command by alias', async () => {});
  it('should throw error for unknown command', async () => {});
  it('should parse command arguments', () => {});
});
```

**StreamingHandler Tests** (`__tests__/StreamingHandler.test.ts`):
```typescript
describe('StreamingHandler', () => {
  it('should start and stop thinking indicator', () => {});
  it('should stream tokens without newlines', () => {});
  it('should handle line breaks correctly', () => {});
  it('should display errors in red', () => {});
  it('should display success in green', () => {});
});
```

**ConversationContext Tests** (`__tests__/ConversationContext.test.ts`):
```typescript
describe('ContextManager', () => {
  it('should create new session', async () => {});
  it('should load existing session', async () => {});
  it('should add user and assistant messages', async () => {});
  it('should retrieve history with limit', async () => {});
  it('should clear history', async () => {});
  it('should manage variables', () => {});
  it('should track active agent', () => {});
});
```

**NaturalLanguageRouter Tests** (`__tests__/NaturalLanguageRouter.test.ts`):
```typescript
describe('NaturalLanguageRouter', () => {
  it('should classify "find X" as query intent', async () => {});
  it('should classify "run workflow" as workflow intent', async () => {});
  it('should classify "use agent" as agent intent', async () => {});
  it('should classify "what is X" as chat intent', async () => {});
  it('should fallback to LLM for ambiguous input', async () => {});
  it('should extract parameters from input', async () => {});
});
```

### Integration Tests

**End-to-End REPL Flow** (`src/__tests__/integration/interactive-cli.test.ts`):
```typescript
describe('Interactive CLI Integration', () => {
  it('should handle full conversation flow', async () => {
    // Simulate user inputs:
    // 1. "find authentication logic"
    // 2. "/agents security"
    // 3. "/memory recent 5"
    // 4. "/exit"

    // Verify:
    // - MemoryService called for search
    // - AgentsCommand executed
    // - History retrieved
    // - Session persisted to database
  });
});
```

### Manual Testing Checklist

- [ ] Launch REPL: `ax cli`
- [ ] Welcome screen displays correctly
- [ ] Prompt shows: `> `
- [ ] Type natural language query, get streaming response
- [ ] Type `/help`, see all 13 commands
- [ ] Type `/agents`, see agent list
- [ ] Type `/memory "test query"`, see search results
- [ ] Type `/history`, see conversation history
- [ ] Type `/context`, see current context
- [ ] Press CTRL+C, session saves and exits
- [ ] Restart, type `/load <session-id>`, history restored
- [ ] Autocomplete works (TAB key)
- [ ] Arrow up/down navigate history
- [ ] Color coding correct (user, assistant, error)
- [ ] Streaming displays token-by-token smoothly
- [ ] Error messages display properly

---

## Success Metrics

### Performance

| Metric | Target | Measurement |
|--------|--------|-------------|
| Input latency | <200ms | Time from Enter to first response token |
| Command execution | <500ms | Slash command completion time |
| Streaming smoothness | No janky frames | Visual inspection |
| Memory usage | <100MB additional | RSS delta after 100 turns |
| Session restore | <1s | Load existing conversation |

### Quality

| Metric | Target | Measurement |
|--------|--------|-------------|
| Intent classification accuracy | >90% | Test suite with 100 examples |
| Autocomplete relevance | >80% | Manual testing |
| Error recovery | 100% | No crashes on invalid input |
| Context retention | 100% | Variables persist across session |
| Test coverage | >80% | Jest/Vitest coverage report |

### Adoption

| Metric | Target | Measurement |
|--------|--------|-------------|
| New user time-to-first-success | <5 minutes | User study (n=10) |
| Command discovery rate | >50% slash commands used | Telemetry |
| Session length | >10 turns average | Telemetry |
| Repeat usage | >3 sessions per user | Telemetry |

---

## Dependencies

### NPM Packages (Install)

```bash
npm install --save readline ora inquirer
npm install --save-dev @types/readline @types/inquirer
```

| Package | Purpose | Version |
|---------|---------|---------|
| `readline` | Core REPL interface | Built-in Node.js |
| `ora` | Loading spinners | ^8.1.1 |
| `inquirer` | Interactive prompts | ^11.2.0 |
| `chalk` | Terminal colors | Already installed |

### Internal Dependencies (Already Available)

- `src/services/ProviderRouterV2.ts` - AI provider routing
- `src/agents/AgentRegistry.ts` - Agent discovery
- `src/agents/AgentRuntime.ts` - Agent execution
- `src/services/WorkflowEngineV2.ts` - Workflow execution
- `src/database/dao/ConversationDAO.ts` - Conversation persistence
- `src/database/dao/MessageDAO.ts` - Message persistence
- `src/memory/MemoryService.ts` - Memory search (if exists)

---

## Migration & Rollout

### Phase 1: Alpha (Internal Testing)

**Week 1-2:**
- Implement core REPL functionality
- Internal team testing (5 developers)
- Gather feedback on UX and performance
- Fix critical bugs

**Success Criteria:**
- âœ… 5/5 developers can complete basic workflow
- âœ… No crashes during 30-minute session
- âœ… Intent classification >80% accurate

### Phase 2: Beta (Early Adopters)

**Week 3:**
- Deploy to 20 early adopters
- Monitor telemetry for usage patterns
- Iterate on autocomplete and suggestions
- Add most-requested slash commands

**Success Criteria:**
- âœ… >15 sessions per user
- âœ… <3 bug reports per user
- âœ… >70% positive feedback

### Phase 3: General Availability

**Week 4:**
- Public release with v8.0.0
- Documentation and tutorials
- Video walkthrough
- Community support channels

**Success Criteria:**
- âœ… >100 active users in first week
- âœ… <5% error rate
- âœ… >80% task completion rate

---

## Risk Mitigation

### Risk 1: Poor Intent Classification

**Probability:** Medium
**Impact:** High (bad user experience)

**Mitigation:**
- Hybrid approach: Pattern matching (fast) + LLM (fallback)
- Continuous learning from user corrections
- Explicit intent confirmation for ambiguous queries
- Allow manual override with slash commands

### Risk 2: Streaming Performance Issues

**Probability:** Low
**Impact:** Medium (janky UX)

**Mitigation:**
- Batch tokens in 50ms windows
- Use async generators for smooth streaming
- Optimize terminal writes (no excessive redraws)
- Load test with 1000+ token responses

### Risk 3: Context Management Complexity

**Probability:** Medium
**Impact:** Medium (lost context, confusion)

**Mitigation:**
- Clear visual indicators of active context
- `/context` command shows full state
- Easy context reset with `/clear`
- Automatic context summarization after 50 turns

### Risk 4: Command Discoverability

**Probability:** Medium
**Impact:** Medium (users don't know features exist)

**Mitigation:**
- Welcome screen with example commands
- Contextual suggestions: "Try `/agents` to see available agents"
- Autocomplete for slash commands
- `/help` command prominently displayed

---

## Documentation Deliverables

### User Documentation

1. **Interactive CLI Guide** (`docs/cli/interactive-mode.md`)
   - What is interactive mode?
   - Basic usage tutorial
   - Slash command reference
   - Example workflows
   - Troubleshooting

2. **Video Walkthrough** (5 minutes)
   - Launch REPL
   - Ask natural language queries
   - Use slash commands
   - Multi-turn conversation
   - Save and restore session

### Developer Documentation

1. **Architecture Doc** (`docs/architecture/interactive-cli.md`)
   - Component diagram
   - Data flow
   - Extension points
   - Adding custom slash commands

2. **API Reference** (JSDoc)
   - `REPLSession` class
   - `SlashCommandRegistry` interface
   - `ConversationContext` interface
   - `StreamingHandler` class

---

## Future Enhancements (Post-P0)

### P1 Features (Week 4-6)

- **Multi-line input:** Allow input spanning multiple lines (triple backticks)
- **Syntax highlighting:** Highlight code in responses
- **File attachments:** `/attach <file>` to add context
- **Voice input:** Speech-to-text for queries
- **Rich formatting:** Tables, charts in terminal

### P2 Features (Post-v8.0.0)

- **Collaborative sessions:** Multiple users in same REPL
- **Web-based REPL:** Browser interface with same features
- **Keyboard shortcuts:** Vim/Emacs keybindings
- **Custom themes:** User-configurable colors
- **Plugin system:** Third-party slash commands

---

## Conclusion

Interactive CLI Mode is the **highest-priority feature** for v8.0.0 feature parity with v7.6.1. It transforms AutomatosX from an experts-only tool into an accessible, conversational AI assistant.

**Key Benefits:**
- âœ… Eliminates learning curve for beginners
- âœ… Maintains power-user efficiency with slash commands
- âœ… Natural conversation reveals capabilities organically
- âœ… Persistent context reduces repetitive input
- âœ… Foundation for all other UX improvements

**Implementation Confidence:** High
- Reuses 90% of existing infrastructure (ProviderRouter, AgentRegistry, DAO layer)
- Simple, well-understood patterns (readline, pattern matching)
- Low complexity, high impact

**Ready to start Week 1 implementation.**

---

**Document Version:** 1.0
**Last Updated:** 2025-01-11
**Next Review:** After Week 1 completion
