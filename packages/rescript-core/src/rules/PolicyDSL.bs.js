// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Js_dict from "rescript/lib/es6/js_dict.js";
import * as Js_json from "rescript/lib/es6/js_json.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";

function allowAction() {
  return "Allow";
}

function denyAction(reason) {
  return {
          TAG: "Deny",
          _0: reason
        };
}

function requireAction(requirement) {
  return {
          TAG: "Require",
          _0: requirement
        };
}

function stateIsCondition(state) {
  return {
          TAG: "StateIs",
          _0: state
        };
}

function eventIsCondition($$event) {
  return {
          TAG: "EventIs",
          _0: $$event
        };
}

function metadataHasCondition(field) {
  return {
          TAG: "MetadataHas",
          _0: field
        };
}

function dependencyAvailableCondition(dep) {
  return {
          TAG: "DependencyAvailable",
          _0: dep
        };
}

function createPolicyRule(ruleId, conditions, action) {
  return {
          ruleId: ruleId,
          conditions: conditions,
          action: action
        };
}

function createPolicy(policyId, version, description, rules) {
  return {
          policyId: policyId,
          version: version,
          description: description,
          rules: rules
        };
}

function actionToString(action) {
  if (typeof action !== "object") {
    return "Allow";
  } else if (action.TAG === "Deny") {
    return "Deny(" + action._0 + ")";
  } else {
    return "Require(" + action._0 + ")";
  }
}

function conditionToString(condition) {
  switch (condition.TAG) {
    case "StateIs" :
        return "StateIs(" + condition._0 + ")";
    case "EventIs" :
        return "EventIs(" + condition._0 + ")";
    case "MetadataHas" :
        return "MetadataHas(" + condition._0 + ")";
    case "DependencyAvailable" :
        return "DependencyAvailable(" + condition._0 + ")";
    
  }
}

function parsePolicy(json) {
  var obj = Js_json.decodeObject(json);
  if (obj === undefined) {
    return {
            TAG: "ParseError",
            _0: "Policy must be a JSON object"
          };
  }
  var value = Js_dict.get(obj, "policyId");
  var policyId;
  if (value !== undefined) {
    var str = Js_json.decodeString(value);
    policyId = str !== undefined ? str : "";
  } else {
    policyId = "";
  }
  var value$1 = Js_dict.get(obj, "version");
  var version;
  if (value$1 !== undefined) {
    var str$1 = Js_json.decodeString(value$1);
    version = str$1 !== undefined ? str$1 : "";
  } else {
    version = "";
  }
  var value$2 = Js_dict.get(obj, "description");
  var description;
  if (value$2 !== undefined) {
    var str$2 = Js_json.decodeString(value$2);
    description = str$2 !== undefined ? str$2 : "";
  } else {
    description = "";
  }
  if (policyId.length === 0) {
    return {
            TAG: "ParseError",
            _0: "policyId is required"
          };
  }
  if (version.length === 0) {
    return {
            TAG: "ParseError",
            _0: "version is required"
          };
  }
  var policy = createPolicy(policyId, version, description, []);
  return {
          TAG: "ParseSuccess",
          _0: policy
        };
}

function validatePolicy(policy) {
  if (policy.policyId.length === 0) {
    return {
            TAG: "Error",
            _0: "policyId cannot be empty"
          };
  } else if (policy.version.length === 0) {
    return {
            TAG: "Error",
            _0: "version cannot be empty"
          };
  } else if (policy.rules.length === 0) {
    return {
            TAG: "Error",
            _0: "policy must have at least one rule"
          };
  } else {
    return {
            TAG: "Ok",
            _0: undefined
          };
  }
}

function policyToString(policy) {
  var rulesStr = Belt_Array.joinWith(Belt_Array.map(policy.rules, (function (rule) {
              return rule.ruleId;
            })), ", ", (function (x) {
          return x;
        }));
  return "Policy(" + policy.policyId + "@" + policy.version + ", rules=[" + rulesStr + "])";
}

function isAllowAction(action) {
  if (typeof action !== "object") {
    return true;
  } else {
    return false;
  }
}

function isDenyAction(action) {
  if (typeof action !== "object" || action.TAG !== "Deny") {
    return false;
  } else {
    return true;
  }
}

function isRequireAction(action) {
  if (typeof action !== "object" || action.TAG === "Deny") {
    return false;
  } else {
    return true;
  }
}

function getRuleCount(policy) {
  return policy.rules.length;
}

function findRule(policy, ruleId) {
  return Belt_Array.getBy(policy.rules, (function (rule) {
                return rule.ruleId === ruleId;
              }));
}

export {
  allowAction ,
  denyAction ,
  requireAction ,
  stateIsCondition ,
  eventIsCondition ,
  metadataHasCondition ,
  dependencyAvailableCondition ,
  createPolicyRule ,
  createPolicy ,
  actionToString ,
  conditionToString ,
  parsePolicy ,
  validatePolicy ,
  policyToString ,
  isAllowAction ,
  isDenyAction ,
  isRequireAction ,
  getRuleCount ,
  findRule ,
}
/* No side effect */
